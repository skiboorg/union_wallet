"use strict";(globalThis["webpackChunkrolf_wallet"]=globalThis["webpackChunkrolf_wallet"]||[]).push([[608],{62608:(e,a,l)=>{l.r(a),l.d(a,{default:()=>M});l(40702),l(84641),l(83269),l(84607),l(25231),l(47725),l(69359),l(56408),l(940),l(13667);var t=l(59835),s=l(60499),u=l(86970),n=l(61957),r=l(99407),o=l(87270),d=l(23459),i=l(46190),m=l(91569),c=l(98030),p=(l(39981),l(17779));const v=(0,t._)("div",{class:"",style:{height:"60px"}},null,-1),g={key:0,class:""},w={class:"flex items-center justify-start q-mb-lg"},b=["src"],y={class:"absolute-bottom-right cursor-pointer",for:"take_img"},h=(0,t._)("p",null,"Фото *",-1),f={class:"row items-center justify-end"},_=(0,t._)("p",{class:"q-mb-none"},"Пол*",-1),U={class:"q-gutter-sm q-mb-lg"},V={key:0,class:""},k={key:1,class:"text-bold text-negative"},q={key:1,class:""},N=(0,t._)("p",{class:"text-bold text-negative"},"На вашем балансе вообще нет MTTL, пополните баланс",-1),x=[N],W=(0,t._)("p",{class:"text-center text-weight-medium"},"Ожидайте верификацию",-1),L={key:0,class:"text-center text-weight-medium"},P=(0,t.Uk)("Если вы не смогли поделиться файлом верификации через соцсеть, то "),T=["href"],R=(0,t.Uk)(" его напрямую"),C={__name:"CreatePersonAlt",setup(e){const a=(0,d.Q)(),l=(0,i.c)(),N=(0,s.iH)(null),C="1048615",j=50,S=320,D=200,F="image/jpeg",Q=1;localStorage.getItem("verify_sent");let I=(0,s.iH)(!1),Z=(0,s.iH)(!1),z=(0,s.iH)(null);const A=(0,s.iH)({firstName:null,lastName:null,middleName:null,birthday:null,gender:0,userPhoto:null,imageUrl:null,passport:null,user_photo:null}),K=(0,s.iH)({amount:"",address:"7R6mzr8YDu1eWiRjBRWyEufz8gL2V9zPmB",title:"Оплата верификации",message:"Оплата верификации",encrypted:!1,fee:0,raw:0}),O=(0,t.Fl)((()=>!A.value.firstName||!A.value.lastName||!A.value.birthday||!A.value.userPhoto||!A.value.passport)),H=(0,t.Fl)((()=>l.balances)),M=((0,t.Fl)((()=>l.addresses[l.currentAddressIdx].publicKey)),(0,t.Fl)((()=>l.addresses[l.currentAddressIdx].address)));async function B(){I.value=!I.value;const e=!0,l=await a.getKeyPair(),t=new r.EraChain.Type.KeyPair(l),s={assetKey:C,amount:j};p.log(t),p.log(s);const u=await c.era.tranRawSendAsset(t,s,K.value.address,K.value.title,K.value.message,K.value.encrypted,e);p.log(u),u.error?((0,o.d)("negative",u.error.message),I.value=!I.value):(K.value.fee=u.fee,K.value.raw=u.raw,await G())}const E=async()=>{let e=N.value.files[0];A.value.user_photo=e;const a=URL.createObjectURL(e),l=new Image;l.src=a,l.onerror=function(){URL.revokeObjectURL(this.src),p.log("Cannot load image")},l.onload=function(){URL.revokeObjectURL(this.src);const[a,t]=J(l,S,D),s=document.createElement("canvas");s.width=a,s.height=t;const u=s.getContext("2d");u.drawImage(l,0,0,a,t),s.toBlob((a=>{p.log("Original file",e),p.log("Compressed file",a),a.size>1e6?(0,o.d)("negative","Выберите другое изображение<br>это слишком большое"):a.size<11e3?(0,o.d)("negative","Выберите другое изображение<br>это слишком маленькое"):(A.value.userPhoto=new File([a],"image.jpg",{type:a.type}),A.value.imageUrl=URL.createObjectURL(A.value.userPhoto))}),F,Q)}};function J(e,a,l){let t=e.width,s=e.height;return t>s?t>a&&(s=Math.round(s*a/t),t=a):s>l&&(t=Math.round(t*l/s),s=l),[t,s]}function Y(){return A.value.middleName?A.value.firstName+" "+A.value.lastName+" "+A.value.middleName:A.value.firstName+" "+A.value.lastName}async function G(){const e=await c.era.broadcast64(K.value.raw);p.log(e),e.error?((0,o.d)("negative",e.message),I.value=!1):((0,o.d)("info","Транзакция создана"),await X()),I.value=!1}const X=async()=>{const e=await a.getKeyPair(),l=new r.EraChain.Type.PublicKeyAccount(e.publicKey),t=new Int8Array(await A.value.userPhoto.arrayBuffer()),s=await new r.EraChain.Type.PersonHuman(l,Y(),new Date(A.value.birthday).getTime(),new Date(A.value.birthday).getTime(),A.value.gender,"",0,0,"","","",0,new Int8Array(0),t,""),u=await s.raw64(e.secretKey);let n=new FormData;n.set("person",JSON.stringify(A.value)),n.set("user_photo",A.value.user_photo),n.set("passport",A.value.passport),n.set("wallet",M.value),n.set("raw",u),p.log(n);await(0,m.h)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/settings/new_person",data:n});(0,o.d)("positive","Запрос на верификацию отправлен<br>Ожидайте...")};return(e,a)=>{const l=(0,t.up)("page-header"),r=(0,t.up)("q-icon"),o=(0,t.up)("q-avatar"),d=(0,t.up)("q-input"),i=(0,t.up)("q-btn"),m=(0,t.up)("q-date"),c=(0,t.up)("q-popup-proxy"),p=(0,t.up)("q-radio"),S=(0,t.up)("q-file"),D=(0,t.up)("btn"),F=(0,t.up)("page-body"),Q=(0,t.up)("page"),K=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(F,{class:"q-px-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(l),v,(0,s.SU)(Z)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",g,[(0,t._)("div",w,[(0,t.Wm)(o,{size:"150px",class:"relative-position q-mr-md"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:A.value.imageUrl?A.value.imageUrl:"/noavatar.png",alt:""},null,8,b),(0,t._)("label",y,[(0,t.Wm)(r,{size:"md",color:"white",class:"bg-primary round q-pa-sm",name:"photo_camera"}),(0,t._)("input",{id:"take_img",ref_key:"photo",ref:N,onChange:E,style:{display:"none"},type:"file"},null,544)])])),_:1}),h]),(0,t.Wm)(d,{rounded:"",modelValue:A.value.firstName,"onUpdate:modelValue":a[0]||(a[0]=e=>A.value.firstName=e),dense:"",label:"Имя*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(d,{rounded:"",modelValue:A.value.lastName,"onUpdate:modelValue":a[1]||(a[1]=e=>A.value.lastName=e),dense:"",label:"Фамилия*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(d,{rounded:"",modelValue:A.value.middleName,"onUpdate:modelValue":a[2]||(a[2]=e=>A.value.middleName=e),dense:"",label:"Отчество",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(d,{rounded:"",label:"Дата рождения*",outlined:"",clearable:"",dense:"",modelValue:A.value.birthday,"onUpdate:modelValue":a[4]||(a[4]=e=>A.value.birthday=e),mask:"date",rules:["date"]},{append:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:A.value.birthday,"onUpdate:modelValue":a[3]||(a[3]=e=>A.value.birthday=e)},{default:(0,t.w5)((()=>[(0,t._)("div",f,[(0,t.wy)((0,t.Wm)(i,{label:"Выбрать",color:"primary",flat:""},null,512),[[K]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),_,(0,t._)("div",U,[(0,t.Wm)(p,{modelValue:A.value.gender,"onUpdate:modelValue":a[5]||(a[5]=e=>A.value.gender=e),val:0,label:"Мужской"},null,8,["modelValue"]),(0,t.Wm)(p,{modelValue:A.value.gender,"onUpdate:modelValue":a[6]||(a[6]=e=>A.value.gender=e),val:1,label:"Женский"},null,8,["modelValue"])]),(0,t.Wm)(S,{rounded:"",modelValue:A.value.passport,"onUpdate:modelValue":a[7]||(a[7]=e=>A.value.passport=e),dense:"",label:"Скан разворота паспорта*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,s.SU)(H)[C]?((0,t.wg)(),(0,t.iD)("div",V,[(0,s.SU)(H)[C][0][1]>=j?((0,t.wg)(),(0,t.j4)(D,{key:0,label:"Оплатить 100 MTTL + газ 0.000435 OLF и отправить запрос на верификацию",disabled:(0,s.SU)(O),loading:(0,s.SU)(I),onClick:B,outline:!1},null,8,["disabled","loading"])):((0,t.wg)(),(0,t.iD)("p",k,"На вашем балансе недостаточно MTTL, пополните баланс. Стоимость верификации "+(0,u.zw)(j)+" MTTL + газ 0.000435 OLF"))])):((0,t.wg)(),(0,t.iD)("div",q,x))])),(0,t.wy)((0,t._)("div",null,[W,(0,s.SU)(z)?((0,t.wg)(),(0,t.iD)("p",L,[P,(0,t._)("a",{style:{},id:"d_link",href:(0,s.SU)(z)},"скачайте",8,T),R])):(0,t.kq)("",!0)],512),[[n.F8,(0,s.SU)(Z)]])])),_:1})])),_:1})}}};var j=l(61357),S=l(22857),D=l(13119),F=l(52765),Q=l(67088),I=l(24455),Z=l(11480),z=l(33837),A=l(62146),K=l(69984),O=l.n(K);const H=C,M=H;O()(C,"components",{QAvatar:j.Z,QIcon:S.Z,QInput:D.Z,QPopupProxy:F.Z,QDate:Q.Z,QBtn:I.Z,QRadio:Z.Z,QFile:z.Z}),O()(C,"directives",{ClosePopup:A.Z})}}]);