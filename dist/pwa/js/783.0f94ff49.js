"use strict";(globalThis["webpackChunkrolf_wallet"]=globalThis["webpackChunkrolf_wallet"]||[]).push([[783],{6783:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Z});a(40702),a(84641),a(83269),a(84607),a(25231),a(47725),a(69359),a(56408),a(940),a(13667);var t=a(59835),u=a(60499),n=a(61957),r=a(99407),o=a(87270),i=a(23459),s=a(46190),d=a(17779);const m=(0,t._)("div",{class:"",style:{height:"60px"}},null,-1),c={key:0,class:""},p={class:"flex items-center justify-start q-mb-lg"},v=["src"],g={class:"absolute-bottom-right cursor-pointer",for:"take_img"},b=(0,t._)("p",null,"Фото *",-1),h={class:"row items-center justify-end"},y=(0,t._)("p",{class:"q-mb-none"},"Пол*",-1),w={class:"q-gutter-sm q-mb-lg"},f=(0,t._)("p",{class:"text-center text-weight-medium"},"Ожидайте верификацию",-1),U={key:0,class:"text-center text-weight-medium"},_=(0,t.Uk)("Если вы не смогли поделиться файлом верификации через соцсеть, то "),V=["href"],k=(0,t.Uk)(" его напрямую"),q={__name:"CreatePerson",setup(e){const l=(0,i.Q)(),a=(0,s.c)(),q=(0,u.iH)(null),x=320,N=200,W="image/jpeg",R=1;localStorage.getItem("verify_sent");let L=(0,u.iH)(!1),P=(0,u.iH)(!1),j=(0,u.iH)(null);const C=(0,u.iH)({firstName:null,lastName:null,middleName:null,birthday:null,gender:0,userPhoto:null,imageUrl:null}),I=(0,t.Fl)((()=>!C.value.firstName||!C.value.lastName||!C.value.birthday||!C.value.userPhoto)),Q=((0,t.Fl)((()=>a.addresses[a.currentAddressIdx].publicKey)),(0,t.Fl)((()=>a.addresses[a.currentAddressIdx].address))),S=async()=>{let e=q.value.files[0];const l=URL.createObjectURL(e),a=new Image;a.src=l,a.onerror=function(){URL.revokeObjectURL(this.src),d.log("Cannot load image")},a.onload=function(){URL.revokeObjectURL(this.src);const[l,t]=Z(a,x,N),u=document.createElement("canvas");u.width=l,u.height=t;const n=u.getContext("2d");n.drawImage(a,0,0,l,t),u.toBlob((l=>{d.log("Original file",e),d.log("Compressed file",l),l.size>1e6?(0,o.d)("negative","Выберите другое изображение<br>это слишком большое"):l.size<11e3?(0,o.d)("negative","Выберите другое изображение<br>это слишком маленькое"):(C.value.userPhoto=new File([l],"image.jpg",{type:l.type}),C.value.imageUrl=URL.createObjectURL(C.value.userPhoto))}),W,R)}};function Z(e,l,a){let t=e.width,u=e.height;return t>u?t>l&&(u=Math.round(u*l/t),t=l):u>a&&(t=Math.round(t*a/u),u=a),[t,u]}function A(){return C.value.middleName?C.value.firstName+" "+C.value.lastName+" "+C.value.middleName:C.value.firstName+" "+C.value.lastName}const O=async()=>{L.value=!L.value;const e=await l.getKeyPair(),a=new r.EraChain.Type.PublicKeyAccount(e.publicKey),t=new Int8Array(await C.value.userPhoto.arrayBuffer()),u=await new r.EraChain.Type.PersonHuman(a,A(),new Date(C.value.birthday).getTime(),new Date(C.value.birthday).getTime(),C.value.gender,"",0,0,"","","",0,new Int8Array(0),t,""),n=await u.raw64(e.secretKey),o=new Blob([n],{type:"text/plain"}),i=new File([o],`${Q.value}.txt`,{type:"text/plain"});d.log(o),j.value=URL.createObjectURL(i),L.value=!L.value,await navigator.share({title:"",text:"Мой raw код для верификации",files:[i]}),P.value=!0;let s=document.getElementById("d_link");s.href=URL.createObjectURL(i),s.setAttribute("download","raw.txt"),localStorage.setItem("verify_sent",!0)};return(e,l)=>{const a=(0,t.up)("page-header"),r=(0,t.up)("q-icon"),o=(0,t.up)("q-avatar"),i=(0,t.up)("q-input"),s=(0,t.up)("q-btn"),d=(0,t.up)("q-date"),x=(0,t.up)("q-popup-proxy"),N=(0,t.up)("q-radio"),W=(0,t.up)("btn"),R=(0,t.up)("page-body"),Q=(0,t.up)("page"),Z=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(R,{class:"q-px-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(a),m,(0,u.SU)(P)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",c,[(0,t._)("div",p,[(0,t.Wm)(o,{size:"150px",class:"relative-position q-mr-md"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:C.value.imageUrl?C.value.imageUrl:"/noavatar.png",alt:""},null,8,v),(0,t._)("label",g,[(0,t.Wm)(r,{size:"md",color:"white",class:"bg-primary round q-pa-sm",name:"photo_camera"}),(0,t._)("input",{id:"take_img",ref_key:"photo",ref:q,onChange:S,style:{display:"none"},type:"file"},null,544)])])),_:1}),b]),(0,t.Wm)(i,{modelValue:C.value.firstName,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value.firstName=e),dense:"",label:"Имя*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(i,{modelValue:C.value.lastName,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value.lastName=e),dense:"",label:"Фамилия *",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(i,{modelValue:C.value.middleName,"onUpdate:modelValue":l[2]||(l[2]=e=>C.value.middleName=e),dense:"",label:"Отчество",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(i,{label:"Дата рождения*",outlined:"",clearable:"",dense:"",modelValue:C.value.birthday,"onUpdate:modelValue":l[4]||(l[4]=e=>C.value.birthday=e),mask:"date",rules:["date"]},{append:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:C.value.birthday,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value.birthday=e)},{default:(0,t.w5)((()=>[(0,t._)("div",h,[(0,t.wy)((0,t.Wm)(s,{label:"Выбрать",color:"primary",flat:""},null,512),[[Z]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),y,(0,t._)("div",w,[(0,t.Wm)(N,{modelValue:C.value.gender,"onUpdate:modelValue":l[5]||(l[5]=e=>C.value.gender=e),val:0,label:"Мужской"},null,8,["modelValue"]),(0,t.Wm)(N,{modelValue:C.value.gender,"onUpdate:modelValue":l[6]||(l[6]=e=>C.value.gender=e),val:1,label:"Женский"},null,8,["modelValue"])]),(0,t.Wm)(W,{label:"Создать код",disabled:(0,u.SU)(I),loading:(0,u.SU)(L),onClick:O,outline:!1},null,8,["disabled","loading"])])),(0,t.wy)((0,t._)("div",null,[f,(0,u.SU)(j)?((0,t.wg)(),(0,t.iD)("p",U,[_,(0,t._)("a",{style:{},id:"d_link",href:(0,u.SU)(j)},"скачайте",8,V),k])):(0,t.kq)("",!0)],512),[[n.F8,(0,u.SU)(P)]])])),_:1})])),_:1})}}};var x=a(61357),N=a(22857),W=a(13119),R=a(52765),L=a(67088),P=a(24455),j=a(11480),C=a(62146),I=a(69984),Q=a.n(I);const S=q,Z=S;Q()(q,"components",{QAvatar:x.Z,QIcon:N.Z,QInput:W.Z,QPopupProxy:R.Z,QDate:L.Z,QBtn:P.Z,QRadio:j.Z}),Q()(q,"directives",{ClosePopup:C.Z})}}]);